name: PlatformIO CI/CD

on:
  pull_request:
    paths-ignore:
      - 'docs/**'
      - 'mkdocs.yml'
      - 'LICENSE'
      - 'README.md'
  push:
    branches:
      - master
      - build-workflow
    paths-ignore:
      - 'docs/**'
      - 'mkdocs.yml'
      - 'LICENSE'
      - 'README.md'
  schedule:
    # do a build once a week at 06:07Z Sunday
    - cron: '7 6 * * 0'
  workflow_dispatch:

jobs:
  deploy-on-testboard:
      name: Deploy code on testboard
      runs-on: windows-latest
      steps:
        - name: Get current time
          uses: josStorer/get-current-time@v2.0.2
          id: current-time
        - name: Get testboard response
          uses: fjogeleit/http-request-action@v1
          id: myRequest
          with:
            url: 'https://eu1.cloud.thethings.network/api/v3/as/applications/paxcounter-cicd/packages/storage/uplink_message'
            method: 'GET'
            bearerToken: ${{ secrets.BEARER_TOKEN }}
            customHeaders: '{"Accept": "text/event-stream"}'
            data: '{"after": "${{ steps.current-time.outputs.time }}", "limit": "1"}'
        - name: Show response
          run: |
            echo ${{ steps.myRequest.outputs.response }}